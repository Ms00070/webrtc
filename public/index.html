<!DOCTYPE html>
<html>
  <head>
    <title>SFU Broadcaster</title>
    <style>
      body { font-family: sans-serif; text-align: center; }
      video { width: 70%; border: 2px solid #333; margin: 20px; }
    </style>
  </head>
  <body>
    <h1>ðŸ“¡ SFU Video Broadcaster</h1>
    <video id="video" autoplay playsinline muted></video><br>
    <input id="streamUrl" placeholder="Enter camera URL e.g. http://192.0.0.4:8080/video">
    <button id="startBtn">Start Stream</button>

    <script>
      const ws = new WebSocket(location.origin.replace(/^http/, "ws"));
      let pc;

      document.getElementById("startBtn").onclick = async () => {
        const url = document.getElementById("streamUrl").value;
        const video = document.getElementById("video");
        video.src = url;

        await video.play();
        const stream = video.captureStream();

        pc = new RTCPeerConnection();
        stream.getTracks().forEach((t) => pc.addTrack(t, stream));

        pc.onicecandidate = ({ candidate }) => {
          if (candidate) ws.send(JSON.stringify({ type: "candidate", candidate }));
        };

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        ws.send(JSON.stringify({ type: "broadcaster", offer }));
      };

      ws.onmessage = async (event) => {
        const msg = JSON.parse(event.data);
        if (msg.type === "answer") await pc.setRemoteDescription(msg.answer);
        if (msg.type === "candidate") await pc.addIceCandidate(msg.candidate);
      };
    </script>
  </body>
</html>
