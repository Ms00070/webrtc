<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SFU Stream Viewer</title>
</head>
<body>
<h2>Mobile Camera Stream via SFU</h2>
<video id="remoteVideo" autoplay playsinline controls width="640"></video>

<script>
const ws = new WebSocket('wss://webrtc-9gdy.onrender.com/');
let pc;

ws.onopen = () => {
  console.log('WebSocket connected');
  ws.send(JSON.stringify({ action: 'getRouterRtpCapabilities' }));
};

ws.onmessage = async (event) => {
  const msg = JSON.parse(event.data);
  if (msg.action === 'routerRtpCapabilities') {
    console.log('Got router capabilities');
    startConsumer(msg.data);
  }
};

async function startConsumer(routerCaps) {
  pc = new RTCPeerConnection();
  const remoteVideo = document.getElementById('remoteVideo');
  pc.ontrack = (event) => (remoteVideo.srcObject = event.streams[0]);

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  // In full SFU setup, you'd send offer → SFU → answer here
  // For demo, this is just showing the structure
}
</script>
</body>
</html>
